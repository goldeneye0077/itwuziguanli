# 模块 08｜后台管理（System Admin）

## 1. 范围与目标

- RBAC：角色权限控制（菜单级、按钮级）
- 数据库管理：简单可视化 CRUD 工具（面向管理员/超级管理员）

## 2. 前端路由与页面

- `/admin/rbac`：角色/权限配置
- `/admin/crud`：通用 CRUD 面板

## 3. OpenAPI 草案（接口字段级别）

### 3.1 RBAC（角色、权限、用户授权）

```yaml
paths:
  /api/v1/admin/rbac/roles:
    get:
      summary: 获取角色列表
      security: [{ bearerAuth: [] }]
      responses:
        "200": { description: OK }
    post:
      summary: 创建角色
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [key, name]
              properties:
                key: { type: string, example: "ADMIN" }
                name: { type: string, example: "管理员" }
      responses:
        "200": { description: OK }

  /api/v1/admin/rbac/permissions:
    get:
      summary: 获取权限点列表（菜单/按钮）
      security: [{ bearerAuth: [] }]
      responses:
        "200": { description: OK }

  /api/v1/admin/rbac/role-bindings:
    post:
      summary: 绑定角色权限
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [role_key, permissions]
              properties:
                role_key: { type: string, example: "ADMIN" }
                permissions:
                  type: array
                  items:
                    type: object
                    required: [resource, actions]
                    properties:
                      resource: { type: string, example: "OUTBOUND" }
                      actions:
                        type: array
                        items:
                          type: string
                          example: "CONFIRM_PICKUP"
      responses:
        "200": { description: OK }

  /api/v1/admin/users/{id}/roles:
    put:
      summary: 设置用户角色（覆盖）
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer, format: int64 }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [roles]
              properties:
                roles:
                  type: array
                  items: { type: string }
      responses:
        "200": { description: OK }
```

### 3.2 数据库管理（通用 CRUD）

```yaml
paths:
  /api/v1/admin/crud/{resource}:
    get:
      summary: 通用查询（按资源名）
      security: [{ bearerAuth: [] }]
      parameters:
        - in: path
          name: resource
          required: true
          schema:
            type: string
            enum: [users, categories, skus, assets, applications, announcements]
        - in: query
          name: q
          schema: { type: string, nullable: true }
        - in: query
          name: page
          schema: { type: integer, minimum: 1, default: 1 }
        - in: query
          name: page_size
          schema: { type: integer, minimum: 1, maximum: 100, default: 20 }
      responses:
        "200": { description: OK }
```

## 4. 数据表与状态机关联

- 数据表：sys_user、（建议新增 rbac_role / rbac_permission / rbac_role_permission / rbac_user_role）、announcement（若实现公告配置）
- 状态机：后台不直接改 Application 状态（除非提供“管理员撤销/纠错”能力）

